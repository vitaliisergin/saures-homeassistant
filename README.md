# Saures Home Assistant Integration

## Версия

1.1

## История изменений

### Версия 1.1 (2025-01-09)

**Критические исправления:**
- Исправлена задержка при сетевых ошибках (60 секунд согласно документации API вместо 2-32 секунд)
- Исправлен конфликт TTL кэша с интервалом обновления для предотвращения получения устаревых данных
- Оптимизированы TTL кэша: user_objects (55 мин), object_meters (55 мин)
- Исправлен домен интеграции: saures_home вместо saures
- Добавлена строгая валидация минимального интервала обновления (60 минут)
- Исправлена обработка WrongSIDException согласно примеру из документации API (использование check_sid вместо прямого вызова update_sid)
- Исправлена обработка неизвестных ошибок API (возврат ответа сразу без retry, согласно строке 352 документации)
- Задержка в check_sid изменена на 1 секунду (согласно строке 376 документации API)

**Стабильность:**
- Предотвращение блокировок IP адреса по причине слишком частых запросов к API Saures
- Гарантированно свежие данные при каждом обновлении (кэш всегда истекает до следующего обновления)

### Версия 1.0 (2025-01-08)

Первый релиз интеграции с базовым функционалом.

## Описание

Интеграция для Home Assistant, которая подключает контроллеры Saures R1 и предоставляет показания счетчиков холодной и горячей воды, состояние контроллеров и диагностические данные API Saures.

## Требования

- Home Assistant 2024.1.0 или новее
- Аккаунт в личном кабинете Saures с контроллером R1

## Установка

1. Скопируйте каталог `custom_components/saures_home` в `config/custom_components/saures_home`.
2. Перезагрузите Home Assistant.

## Настройка

1. В интерфейсе Home Assistant откройте Настройки → Интеграции.
2. Добавьте интеграцию `Saures Home`.
3. Укажите учетные данные Saures и интервал обновления (60–1440 минут, рекомендуется 60 минут).

## Доступные данные

- Показания счетчиков холодной и горячей воды.
- Время последнего подключения, запроса и снятия показаний.
- Уровень заряда батареи и качество связи (RSSI).
- Статус API, ошибки, состояние кэша и срок действия сессии.

## Обновление

При обновлении удалите старые файлы интеграции и повторно скопируйте актуальную версию. После обновления перезагрузите Home Assistant.

## Поддержка

- Вопросы и предложения: `https://github.com/vitaliisergin/saures-homeassistant/discussions`
- Сообщить об ошибке: `https://github.com/vitaliisergin/saures-homeassistant/issues`

## Лицензия

MIT License. Полный текст доступен в файле `LICENSE`.
